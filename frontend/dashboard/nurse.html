<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CareLink - Nurse Dashboard</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #2563eb;
        --primary-dark: #1d4ed8;
        --secondary-color: #06b6d4;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --light-bg: #f8fafc;
        --dark-text: #1e293b;
        --light-text: #64748b;
        --white: #ffffff;
        --border-color: #e2e8f0;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--light-bg);
        color: var(--dark-text);
        line-height: 1.6;
      }

      .sidebar {
        min-height: 100vh;
        background: var(--white);
        border-right: 1px solid var(--border-color);
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        position: fixed;
        width: 280px;
        z-index: 1000;
        transition: transform 0.3s ease;
      }

      .sidebar-brand {
        padding: 1.5rem;
        border-bottom: 1px solid var(--border-color);
      }

      .brand-link {
        text-decoration: none;
        color: var(--dark-text);
        font-size: 1.5rem;
        font-weight: 700;
        display: flex;
        align-items: center;
      }

      .brand-icon {
        color: var(--primary-color);
        margin-right: 0.5rem;
        font-size: 1.8rem;
      }

      .sidebar-nav {
        padding: 1rem 0;
      }

      .nav-item {
        margin: 0.25rem 0;
      }

      .nav-link {
        display: flex;
        align-items: center;
        padding: 0.75rem 1.5rem;
        color: var(--light-text);
        text-decoration: none;
        border-radius: 0;
        transition: all 0.3s ease;
        position: relative;
      }

      .nav-link:hover,
      .nav-link.active {
        background: linear-gradient(90deg, rgba(37, 99, 235, 0.1), transparent);
        color: var(--primary-color);
        border-right: 3px solid var(--primary-color);
      }

      .nav-link i {
        width: 20px;
        margin-right: 0.75rem;
        text-align: center;
      }

      .main-content {
        margin-left: 280px;
        min-height: 100vh;
        transition: margin-left 0.3s ease;
      }

      .topbar {
        background: var(--white);
        border-bottom: 1px solid var(--border-color);
        padding: 1rem 2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .topbar-left h1 {
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--dark-text);
        margin: 0;
      }

      .topbar-right {
        margin-left: auto;
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .nurse-info {
        display: flex;
        align-items: center;
        background: var(--light-bg);
        padding: 0.5rem 1rem;
        border-radius: 50px;
        border: 1px solid var(--border-color);
      }

      .nurse-avatar {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: linear-gradient(45deg, var(--secondary-color), #0891b2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        margin-right: 0.5rem;
      }

      .content-area {
        padding: 2rem;
      }

      .dashboard-card {
        background: var(--white);
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid var(--border-color);
        margin-bottom: 2rem;
      }

      .card-header {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .card-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--dark-text);
        margin: 0;
        display: flex;
        align-items: center;
      }

      .card-title i {
        margin-right: 0.5rem;
        color: var(--secondary-color);
      }

      .card-body {
        padding: 2rem;
      }

      .btn-modern {
        background: linear-gradient(
          45deg,
          var(--primary-color),
          var(--primary-dark)
        );
        border: none;
        color: white;
        padding: 0.5rem 1.5rem;
        border-radius: 25px;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
      }

      .btn-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
        color: white;
      }

      .btn-logout {
        background: linear-gradient(45deg, var(--danger-color), #dc2626);
        border: none;
        color: white;
        padding: 0.5rem 1.5rem;
        border-radius: 25px;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
      }

      .btn-logout:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        color: white;
      }

      .table-modern {
        background: transparent;
      }

      .table-modern thead th {
        background: var(--light-bg);
        color: var(--dark-text);
        font-weight: 600;
        border: none;
        padding: 1rem;
      }

      .table-modern tbody tr {
        border-bottom: 1px solid var(--border-color);
        transition: all 0.3s ease;
      }

      .table-modern tbody tr:hover {
        background: rgba(37, 99, 235, 0.05);
      }

      .table-modern tbody td {
        padding: 1rem;
        border: none;
        vertical-align: middle;
      }

      .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
        text-transform: capitalize;
      }

      .status-badge.pending {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning-color);
      }

      .status-badge.approved {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
      }

      .status-badge.cancelled {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger-color);
      }

      .status-badge.rescheduled {
        background: rgba(6, 182, 212, 0.1);
        color: var(--secondary-color);
      }

      .empty-state {
        text-align: center;
        padding: 3rem 2rem;
        color: var(--light-text);
      }

      .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: var(--border-color);
      }

      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.show {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .topbar {
          padding: 1rem;
        }

        .content-area {
          padding: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="sidebar" id="sidebar">
      <div class="sidebar-brand">
        <a href="#" class="brand-link">
          <i class="fas fa-heart-pulse brand-icon"></i>
          CareLink
        </a>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-item">
          <a href="#" class="nav-link active">
            <i class="fas fa-tachometer-alt"></i>
            Dashboard
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link">
            <i class="fas fa-calendar-check"></i>
            Appointments
          </a>
        </div>
        <div class="nav-item">
    <a href="#" class="nav-link">
      <i class="fas fa-money-bill-wave"></i>
      My Payments
    </a>
  </div>
        <div class="nav-item">
          <a href="#" class="nav-link">
            <i class="fas fa-chart-bar"></i>
            Reports
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link">
            <i class="fas fa-cog"></i>
            Settings
          </a>
        </div>
      </nav>
    </div>

    <div class="main-content">
      <div class="topbar">
        <div class="topbar-left">
          <button class="btn btn-link d-lg-none" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
          </button>
          <h1>Nurse Dashboard</h1>
        </div>
        <div class="topbar-right">
          <div class="nurse-info">
            <div class="nurse-avatar">N</div>
            <span class="fw-medium" id="nurseName">Nurse</span>
          </div>
          <button class="btn btn-logout" id="btnLogout">
            <i class="fas fa-sign-out-alt me-1"></i>
            Logout
          </button>
        </div>
      </div>

      <div class="content-area">
        <div class="dashboard-card" id="appointmentsSection">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-calendar-check"></i>
              My Appointments
            </h5>
            <button class="btn btn-modern" id="btnLoadAppointments">
              <i class="fas fa-sync me-1"></i>
              Refresh Appointments
            </button>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-modern">
                <thead>
                  <tr>
                    <th>Appointment ID</th>
                    <th>Nurse</th>
                    <th>Service Amount</th>
                    <th>Payment Status</th>
                    <th>My Payment</th>
                  </tr>
                </thead>
                <tbody id="tblAppointments">
                  <tr>
                    <td colspan="4" class="empty-state">
                      <i class="fas fa-calendar-alt"></i>
                      <p>
                        Click "Refresh Appointments" to load your appointments
                      </p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
   <!-- Payment Status Section -->
<div class="dashboard-card">
  <div class="card-header">
    <h5 class="card-title">
      <i class="fas fa-money-bill-wave"></i>
      My Payments
    </h5>
    <div class="d-flex align-items-center gap-2">
      <div class="btn-group">
        <button class="btn btn-outline-primary btn-sm" onclick="loadPayments('all')">All</button>
        <button class="btn btn-outline-warning btn-sm" onclick="loadPayments('pending')">Pending</button>
        <button class="btn btn-outline-success btn-sm" onclick="loadPayments('paid')">Paid</button>
      </div>
      <button class="btn btn-modern" id="btnLoadPaymentStatus">
        <i class="fas fa-sync me-1"></i>
        Refresh
      </button>
    </div>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-modern">
        <thead>
          <tr>
            <th>Appointment ID</th>
            <th>Nurse</th>
            <th>Service Amount</th>
            <th>Payment Status</th>
            <th>My Payment</th>
          </tr>
        </thead>
        <tbody id="tblNursePayments">
          <tr>
            <td colspan="5" class="empty-state">
              <i class="fas fa-money-bill-wave"></i>
              <p>Click "Refresh" to load payment status</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
      const API = "http://127.0.0.1:5000";
      
      const user = JSON.parse(localStorage.getItem("user") || "{}");

      if (!user.id || user.role !== "nurse") {
        alert("Access denied!");
        window.location.href = "../pages/register.html";
      } else {
        document.getElementById("nurseName").textContent = user.name || "Nurse";
      }

      document.getElementById("btnLogout").onclick = () => {
        localStorage.removeItem("user");
        window.location.href = "../pages/register.html";
      };

      function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("show");
      }

      document.getElementById("btnLoadAppointments").onclick = async () => {
        const tbody = document.getElementById("tblAppointments");
        tbody.innerHTML =
          '<tr><td colspan="4" class="text-center"><i class="fas fa-spinner fa-spin"></i> Loading...</td></tr>';
        try {
          const res = await fetch(
            `${API}/api/appointments?userId=${user.id}&role=nurse`
          );
          const rows = await res.json();

          if (rows.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="4" class="empty-state"><i class="fas fa-calendar-alt"></i><p>No appointments found</p></td></tr>';
            return;
          }

          tbody.innerHTML = "";
          rows.forEach((r) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td><strong>#${r.id}</strong></td>
              <td>${r.patient_id ? `Patient #${r.patient_id}` : "N/A"}</td>
              <td>
                <span class="status-badge ${r.status}">${r.status}</span>
              </td>
              <td>${
                r.date ? new Date(r.date).toLocaleString() : "Not scheduled"
              }</td>
            `;
            tbody.appendChild(tr);
          });
        } catch (e) {
          tbody.innerHTML = `<tr><td colspan="4" class="empty-state text-danger"><i class="fas fa-exclamation-triangle"></i><p>Error: ${e.message}</p></td></tr>`;
        }
      };

      
      // Payment Functions for Nurse
document.getElementById("btnLoadPaymentStatus").onclick = async () => {
  const tbody = document.getElementById("tblNursePayments");
  tbody.innerHTML = '<tr><td colspan="5" class="text-center"><i class="fas fa-spinner fa-spin"></i> Loading...</td></tr>';
  
  try {
    // ✅ Correct API endpoint for nurse payments
    const res = await fetch(`${API}/api/nurse-payments/nurse/${user.id}`);
    const payments = await res.json();
    
    if (payments.length === 0) {
      tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><i class="fas fa-money-bill-wave"></i><p>No payment records found</p></td></tr>';
      return;
    }
    
    tbody.innerHTML = "";
    payments.forEach(payment => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>#${payment.appointment_id}</td>
        <td>${payment.nurse_name || 'Nurse #' + payment.nurse_id}</td>
        <td>$${payment.service_amount}</td>
        <td><span class="status-badge ${payment.payment_status}">${payment.payment_status}</span></td>
        <td><strong>$${payment.nurse_amount}</strong></td>
      `;
      tbody.appendChild(tr);
    });
  } catch (e) {
    console.error("Payment loading error:", e);
    tbody.innerHTML = `<tr><td colspan="5" class="empty-state text-danger"><i class="fas fa-exclamation-triangle"></i><p>Error loading payments</p></td></tr>`;
  }
};
// Filter function for payments
async function loadPayments(status = 'all') {
  const tbody = document.getElementById("tblNursePayments");
  tbody.innerHTML = '<tr><td colspan="5" class="text-center"><i class="fas fa-spinner fa-spin"></i> Loading...</td></tr>';
  
  try {
    const res = await fetch(`${API}/api/nurse-payments/nurse/${user.id}?status=${status}`);
    const payments = await res.json();
    
    if (payments.length === 0) {
      tbody.innerHTML = `<tr><td colspan="5" class="empty-state"><i class="fas fa-money-bill-wave"></i><p>No ${status} payments found</p></td></tr>`;
      return;
    }
    
    tbody.innerHTML = "";
    payments.forEach(payment => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>#${payment.appointment_id}</td>
        <td>${payment.nurse_name || 'Nurse #' + payment.nurse_id}</td>
        <td>$${payment.service_amount}</td>
        <td><span class="status-badge ${payment.payment_status}">${payment.payment_status}</span></td>
        <td><strong>$${payment.nurse_amount}</strong></td>
      `;
      tbody.appendChild(tr);
    });
  } catch (e) {
    console.error("Payment loading error:", e);
    tbody.innerHTML = `<tr><td colspan="5" class="empty-state text-danger"><i class="fas fa-exclamation-triangle"></i><p>Error loading payments</p></td></tr>`;
  }
}

// Update the existing button to use the filter function
document.getElementById("btnLoadPaymentStatus").onclick = () => loadPayments('all');
// Load payment status when page loads
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("btnLoadAppointments").click();
  document.getElementById("btnLoadPaymentStatus").click();
});
    </script>
  </body>
</html>
